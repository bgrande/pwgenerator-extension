<?xml version="1.0" encoding="UTF-8"?>
<project name="build" default="all" basedir=".">

    <property name="build-dir" value="build" />
    <property name="project-name" value="password-generator" />

    <property name="chrome-version" value="1.1.2" />
    <property name="chrome-project-name" value="chrome-${project-name}" />
    <property name="chrome-folder-to-zip" value="${chrome-project-name}-${chrome-version}" />

    <property name="firefox-version" value="0.1.0" />
    <property name="firefox-project-name" value="firefox-${project-name}" />
    <property name="firefox-folder-to-zip" value="${firefox-project-name}-${firefox-version}" />

    <fileset id="vault" dir="vendor/vault/lib">
        <exclude name="app.js" />
        <exclude name="style.css" />
    </fileset>

    <fileset id="common" dir="common" />

    <target name="clean">
        <delete dir="temp" />
    </target>

    <target name="prepare" depends="clean">
        <mkdir dir="temp" />
    </target>

    <target name="prepare-chrome" depends="prepare">
        <property name="chrome-path" value="chrome-extension" />

        <mkdir dir="temp/${chrome-folder-to-zip}" />

        <mkdir dir="${chrome-path}/lib" />

        <copy todir="${chrome-path}/lib">
            <fileset refid="vault" />
        </copy>

        <copy todir="chrome-extension/">
            <fileset refid="common" />
        </copy>

        <copy todir="temp/${chrome-folder-to-zip}">
            <fileset dir="chrome-extension" />
        </copy>
    </target>

    <target name="prepare-firefox" depends="prepare">
        <property name="firefox-path" value="firefox-extension/data/" />

        <mkdir dir="temp/${firefox-folder-to-zip}" />

        <mkdir dir="${firefox-path}/lib" />

        <copy todir="${firefox-path}/lib">
            <fileset refid="vault" />
        </copy>

        <copy todir="${firefox-path}">
            <fileset refid="common" />
        </copy>

        <copy file="common/images/icon48.png" tofile="firefox-extension/icon.png" />
        <copy file="common/images/icon64.png" tofile="firefox-extension/icon64.png" />

        <copy todir="temp/${firefox-folder-to-zip}">
            <fileset dir="firefox-extension" />
        </copy>
    </target>

    <target name="chrome" depends="prepare-chrome">
        <copy file="src/key.pem" todir="temp/${chrome-folder-to-zip}/" />
        <zip destfile="${build-dir}/${project-name}-${chrome-version}.zip" basedir="temp/${chrome-folder-to-zip}" />
    </target>

    <target name="firefox" depends="prepare-firefox">
        <zip destfile="${build-dir}/${project-name}-${firefox-version}.xpi" basedir="temp/${firefox-folder-to-zip}" />
    </target>

    <target name="all" depends="chrome,firefox" />
    <target name="prepare-all" depends="prepare-chrome,prepare-firefox" />

</project>